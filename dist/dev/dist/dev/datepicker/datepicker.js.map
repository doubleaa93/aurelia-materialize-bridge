{"version":3,"sources":["datepicker/datepicker.js"],"names":["bindable","customAttribute","bindingMode","TaskQueue","inject","getLogger","getBooleanFromAttributeValue","DatePickerDefaultParser","MdDatePicker","Element","defaultBindingMode","twoWay","oneTime","element","taskQueue","defaultParser","log","parsers","push","bind","selectMonths","selectYears","parseInt","classList","add","options","onClose","$","document","activeElement","blur","i18n","Object","assign","container","picker","pickadate","on","onSet","value","set","editable","e","keyCode","parseDate","val","closeDatePicker","openDatePicker","showIcon","calendarIcon","createElement","textContent","parentNode","insertBefore","nextSibling","onCalendarIconClick","movePickerCloserToSrc","length","parser","canParse","parsedDate","parse","$root","appendTo","parent","detached","stop","selected","get","obj","event","stopPropagation","closeOnSelect","select","close","valueChanged","newValue","max","debug"],"mappings":"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","file":"../../../datepicker/datepicker.js","sourcesContent":["import {bindable, customAttribute} from 'aurelia-templating';\r\nimport {bindingMode} from 'aurelia-binding';\r\nimport {TaskQueue} from 'aurelia-task-queue';\r\nimport {inject} from 'aurelia-dependency-injection';\r\nimport {getLogger} from 'aurelia-logging';\r\nimport {getBooleanFromAttributeValue} from '../common/attributes';\r\nimport {DatePickerDefaultParser} from './datepicker.default-parser';\r\n\r\n@inject(Element, TaskQueue, DatePickerDefaultParser)\r\n@customAttribute('md-datepicker')\r\nexport class MdDatePicker {\r\n  @bindable() container;\r\n  @bindable() translation;\r\n  @bindable({defaultBindingMode: bindingMode.twoWay}) value;\r\n  @bindable({defaultBindingMode: bindingMode.twoWay}) parsers = [];\r\n  @bindable({defaultBindingMode: bindingMode.oneTime}) selectMonths = true;\r\n  @bindable({defaultBindingMode: bindingMode.oneTime}) selectYears = 15;\r\n  @bindable({defaultBindingMode: bindingMode.oneTime}) options = {};\r\n\r\n  constructor(element, taskQueue, defaultParser) {\r\n    this.element = element;\r\n    this.log = getLogger('md-datepicker');\r\n    this.taskQueue = taskQueue;\r\n    this.parsers.push(defaultParser);\r\n  }\r\n\r\n  bind() {\r\n    this.selectMonths = getBooleanFromAttributeValue(this.selectMonths);\r\n    this.selectYears = parseInt(this.selectYears, 10);\r\n    this.element.classList.add('date-picker');\r\n\r\n    let options = {\r\n      selectMonths: this.selectMonths,\r\n      selectYears: this.selectYears,\r\n      onClose: function() {\r\n        // see https://github.com/Dogfalo/materialize/issues/2067\r\n        // and: https://github.com/amsul/pickadate.js/issues/160\r\n        $(document.activeElement).blur();\r\n        // $(this.element).blur();\r\n      }\r\n    };\r\n    let i18n = {};\r\n    // let i18n = {\r\n    //   selectMonths: true, // Creates a dropdown to control month\r\n    //   selectYears: 15, // Creates a dropdown of 15 years to control year\r\n    //   monthsFull: [ 'Januar', 'Februar', 'März', 'April', 'Mai', 'Juni', 'Juli', 'August', 'September', 'Oktober', 'November', 'Dezember' ],\r\n    //   monthsShort: [ 'Jan', 'Feb', 'Mär', 'Apr', 'Mai', 'Jun', 'Jul', 'Aug', 'Sep', 'Okt', 'Nov', 'Dez' ],\r\n    //   weekdaysFull: [ 'Sonntag', 'Montag', 'Dienstag', 'Mittwoch', 'Donnerstag', 'Freitag', 'Samstag' ],\r\n    //   weekdaysShort: [ 'So', 'Mo', 'Di', 'Mi', 'Do', 'Fr', 'Sa' ],\r\n    //   today: 'Heute',\r\n    //   clear: 'Löschen',\r\n    //   close: 'Schließen',\r\n    //   firstDay: 1,\r\n    //   format: 'dddd, dd. mmmm yyyy',\r\n    //   formatSubmit: 'yyyy/mm/dd'\r\n    // };\r\n    Object.assign(options, i18n);\r\n\r\n    if (this.options) {\r\n      Object.assign(options, this.options);\r\n      //merge callback methods if there is a hook in the advanced options\r\n      if (this.options.onClose) {\r\n        options.onClose = function() {\r\n          this.options.onClose();\r\n          $(document.activeElement).blur();\r\n        };\r\n      }\r\n    }\r\n    if (this.container) {\r\n      options.container = this.container;\r\n    }\r\n    this.picker = $(this.element).pickadate(options).pickadate('picker');\r\n    this.picker.on({\r\n      'close': this.onClose.bind(this),\r\n      'set': this.onSet.bind(this)\r\n    });\r\n\r\n    if (this.value) {\r\n      this.picker.set('select', this.value);\r\n    }\r\n    if (this.options && this.options.editable) {\r\n      $(this.element).on('keydown', (e)=> {\r\n        if (e.keyCode === 13 || e.keyCode === 9) {\r\n          if (this.parseDate($(this.element).val())) {\r\n            this.closeDatePicker();\r\n          } else {\r\n            this.openDatePicker();\r\n          }\r\n        } else {\r\n          this.value = null;\r\n        }\r\n      });\r\n    } else {\r\n      $(this.element).on('focusin', () => {\r\n        this.openDatePicker();\r\n      });\r\n    }\r\n    if (this.options.showIcon) {\r\n      this.element.classList.add('left');\r\n      let calendarIcon = document.createElement('i');\r\n      calendarIcon.classList.add('right');\r\n      calendarIcon.classList.add('material-icons');\r\n      calendarIcon.textContent = 'today';\r\n      this.element.parentNode.insertBefore(calendarIcon, this.element.nextSibling);\r\n      $(calendarIcon).on('click', this.onCalendarIconClick.bind(this));\r\n    }\r\n\r\n    this.movePickerCloserToSrc();\r\n  }\r\n\r\n  parseDate(value) {\r\n    if (this.parsers && this.parsers.length && this.parsers.length > 0) {\r\n      for (const parser of this.parsers) {\r\n        if (parser.canParse(value)) {\r\n          const parsedDate = parser.parse(value);\r\n          if (parsedDate !== null) {\r\n            this.picker.set('select', parsedDate);\r\n            return true;\r\n          }\r\n        }\r\n      }\r\n    }\r\n    return false;\r\n  }\r\n\r\n  movePickerCloserToSrc() {\r\n    $(this.picker.$root).appendTo($(this.element).parent());\r\n  }\r\n\r\n  detached() {\r\n    if (this.picker) {\r\n      this.picker.stop();\r\n    }\r\n  }\r\n\r\n  openDatePicker() {\r\n    $(this.element).pickadate('open');\r\n  }\r\n\r\n  closeDatePicker() {\r\n    $(this.element).pickadate('close');\r\n  }\r\n\r\n  onClose() {\r\n    let selected = this.picker.get('select');\r\n    this.value = selected ? selected.obj : null;\r\n  }\r\n\r\n  onCalendarIconClick(event) {\r\n    event.stopPropagation();\r\n    this.openDatePicker();\r\n  }\r\n\r\n  onSet(value) {\r\n    //handle this ourselves since Dogfalo removed this functionality from the original plugin\r\n    if (this.options && this.options.closeOnSelect && value.select) {\r\n      this.value = value.select;\r\n      this.picker.close();\r\n    }\r\n    // this.value = new Date(value.select);\r\n  }\r\n\r\n  valueChanged(newValue) {\r\n    if (this.options.max && newValue > this.options.max) {\r\n      this.value = this.options.max;\r\n    }\r\n    this.log.debug('selectedChanged', this.value);\r\n    // this.taskQueue.queueTask(() => {\r\n    this.picker.set('select', this.value);\r\n    // });\r\n  }\r\n\r\n\r\n}\r\n"]}
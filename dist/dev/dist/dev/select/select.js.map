{"version":3,"sources":["select/select.js"],"names":["bindable","customAttribute","BindingEngine","inject","TaskQueue","LogManager","fireEvent","getBooleanFromAttributeValue","DOM","MdSelect","Element","element","logManager","bindingEngine","taskQueue","_suspendUpdate","subscriptions","input","dropdownMutationObserver","_taskqueueRunning","handleChangeFromViewModel","bind","handleChangeFromNativeSelect","handleBlur","log","getLogger","attached","queueTask","createMaterialSelect","label","wrapper","$","parent","div","va","attributes","getNamedItem","attr","name","wrap","insertAfter","push","propertyObserver","subscribe","on","detached","off","observeVisibleDropdownContent","material_select","forEach","sub","dispose","refresh","disabledChanged","newValue","toggleControl","showErrortextChanged","setErrorTextAttribute","parentElement","querySelector","debug","showErrortext","setAttribute","notifyBindingEngine","arguments","value","val","disable","$wrapper","length","addClass","removeClass","dropdown","destroy","disabled","attach","createMutationObserver","isHidden","mutations","mutation","window","getComputedStyle","target","getPropertyValue","takeRecords","observe","attributeFilter","disconnect"],"mappings":"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","file":"../../../select/select.js","sourcesContent":["import {bindable, customAttribute} from 'aurelia-templating';\r\nimport {BindingEngine} from 'aurelia-binding';\r\nimport {inject} from 'aurelia-dependency-injection';\r\nimport {TaskQueue} from 'aurelia-task-queue';\r\nimport * as LogManager from 'aurelia-logging';\r\nimport {fireEvent} from '../common/events';\r\nimport {getBooleanFromAttributeValue} from '../common/attributes';\r\nimport {DOM} from 'aurelia-pal';\r\n\r\n@inject(Element, LogManager, BindingEngine, TaskQueue)\r\n@customAttribute('md-select')\r\nexport class MdSelect {\r\n  @bindable() disabled = false;\r\n  @bindable() label = '';\r\n  @bindable() showErrortext = true;\r\n  _suspendUpdate = false;\r\n  subscriptions = [];\r\n  input = null;\r\n  dropdownMutationObserver = null;\r\n\r\n  constructor(element, logManager, bindingEngine, taskQueue) {\r\n    this.element = element;\r\n    this.taskQueue = taskQueue;\r\n    this.handleChangeFromViewModel = this.handleChangeFromViewModel.bind(this);\r\n    this.handleChangeFromNativeSelect = this.handleChangeFromNativeSelect.bind(this);\r\n    this.handleBlur = this.handleBlur.bind(this);\r\n    this.log = LogManager.getLogger('md-select');\r\n    this.bindingEngine = bindingEngine;\r\n  }\r\n\r\n  attached() {\r\n    this.taskQueue.queueTask(() => {\r\n      this.createMaterialSelect(false);\r\n\r\n      if (this.label) {\r\n        let wrapper = $(this.element).parent('.select-wrapper');\r\n        let div = $('<div class=\"input-field\"></div>');\r\n        let va = this.element.attributes.getNamedItem('validate');\r\n        if (va) {\r\n          div.attr(va.name, va.label);\r\n        }\r\n        wrapper.wrap(div);\r\n        $(`<label>${this.label}</label>`).insertAfter(wrapper);\r\n      }\r\n    });\r\n    this.subscriptions.push(this.bindingEngine.propertyObserver(this.element, 'value').subscribe(this.handleChangeFromViewModel));\r\n    // this.subscriptions.push(this.bindingEngine.propertyObserver(this.element, 'selectedOptions').subscribe(this.notifyBindingEngine.bind(this)));\r\n    // $(this.element).material_select(() => {\r\n    //   this.log.warn('materialize callback', $(this.element).val());\r\n    //   this.handleChangeFromNativeSelect();\r\n    // });\r\n\r\n    $(this.element).on('change', this.handleChangeFromNativeSelect);\r\n  }\r\n\r\n  detached() {\r\n    $(this.element).off('change', this.handleChangeFromNativeSelect);\r\n    this.observeVisibleDropdownContent(false);\r\n    this.dropdownMutationObserver = null;\r\n    $(this.element).material_select('destroy');\r\n    this.subscriptions.forEach(sub => sub.dispose());\r\n  }\r\n\r\n  refresh() {\r\n    this.taskQueue.queueTask(() => {\r\n      this.createMaterialSelect(true);\r\n    });\r\n  }\r\n\r\n  disabledChanged(newValue) {\r\n    this.toggleControl(newValue);\r\n  }\r\n\r\n  showErrortextChanged() {\r\n    this.setErrorTextAttribute();\r\n  }\r\n\r\n  setErrorTextAttribute() {\r\n    let input = this.element.parentElement.querySelector('input.select-dropdown');\r\n    if (!input) return;\r\n    this.log.debug('showErrortextChanged: ' + this.showErrortext);\r\n    input.setAttribute('data-show-errortext', getBooleanFromAttributeValue(this.showErrortext));\r\n  }\r\n\r\n  notifyBindingEngine() {\r\n    this.log.debug('selectedOptions changed', arguments);\r\n  }\r\n\r\n  handleChangeFromNativeSelect() {\r\n    if (!this._suspendUpdate) {\r\n      this.log.debug('handleChangeFromNativeSelect', this.element.value, $(this.element).val());\r\n      this._suspendUpdate = true;\r\n      fireEvent(this.element, 'change');\r\n      this._suspendUpdate = false;\r\n    }\r\n  }\r\n\r\n  handleChangeFromViewModel(newValue) {\r\n    this.log.debug('handleChangeFromViewModel', newValue, $(this.element).val());\r\n    if (!this._suspendUpdate) {\r\n      this.createMaterialSelect(false);\r\n    }\r\n  }\r\n\r\n  toggleControl(disable) {\r\n    let $wrapper = $(this.element).parent('.select-wrapper');\r\n    if ($wrapper.length > 0) {\r\n      if (disable) {\r\n        $('.caret', $wrapper).addClass('disabled');\r\n        $('input.select-dropdown', $wrapper).attr('disabled', 'disabled');\r\n        $wrapper.attr('disabled', 'disabled');\r\n      } else {\r\n        $('.caret', $wrapper).removeClass('disabled');\r\n        $('input.select-dropdown', $wrapper).attr('disabled', null);\r\n        $wrapper.attr('disabled', null);\r\n        $('.select-dropdown', $wrapper).dropdown({'hover': false, 'closeOnClick': false});\r\n      }\r\n    }\r\n  }\r\n\r\n  createMaterialSelect(destroy) {\r\n    this.observeVisibleDropdownContent(false);\r\n    if (destroy) {\r\n      $(this.element).material_select('destroy');\r\n    }\r\n    $(this.element).material_select();\r\n    this.toggleControl(this.disabled);\r\n    this.observeVisibleDropdownContent(true);\r\n    this.setErrorTextAttribute();\r\n  }\r\n\r\n  observeVisibleDropdownContent(attach) {\r\n    if (attach) {\r\n      if (!this.dropdownMutationObserver) {\r\n        this.dropdownMutationObserver = DOM.createMutationObserver(mutations => {\r\n          let isHidden = false;\r\n          for (let mutation of mutations) {\r\n            if (window.getComputedStyle(mutation.target).getPropertyValue('display') === 'none') {\r\n              isHidden = true;\r\n            }\r\n          }\r\n          if (isHidden) {\r\n            this.dropdownMutationObserver.takeRecords();\r\n            this.handleBlur();\r\n          }\r\n        });\r\n      }\r\n      this.dropdownMutationObserver.observe(this.element.parentElement.querySelector('.dropdown-content'), {\r\n        attributes: true,\r\n        attributeFilter: ['style']\r\n      });\r\n    } else {\r\n      if (this.dropdownMutationObserver) {\r\n        this.dropdownMutationObserver.disconnect();\r\n        this.dropdownMutationObserver.takeRecords();\r\n      }\r\n    }\r\n  }\r\n\r\n  //\r\n  // Firefox sometimes fire blur several times in a row\r\n  // observable at http://localhost:3000/#/samples/select/\r\n  // when enable 'Disable Functionality', open that list and\r\n  // then open 'Basic use' list.\r\n  // Chrome - ok\r\n  // IE 11 - ok\r\n  // Edge ?\r\n  //\r\n  _taskqueueRunning = false;\r\n\r\n  handleBlur() {\r\n    if (this._taskqueueRunning) return;\r\n    this._taskqueueRunning = true;\r\n    this.taskQueue.queueTask(() => {\r\n      this.log.debug('fire blur event');\r\n      fireEvent(this.element, 'blur');\r\n      this._taskqueueRunning = false;\r\n    });\r\n  }\r\n}\r\n"]}